---
title: 08ì¥. ìŠ¤í† ë¦¬ì§€ ìŠ¤íƒ ê´€ë¦¬
excerpt: ë…¼ë¦¬ ë³¼ë¥¨ - LVM(Logical Volume Manager) ê´€ë¦¬ ë° ê³„ì¸µí™” ìŠ¤í† ë¦¬ì§€ ê´€ë¦¬
lang: ko
layout: single.private
categories:
  - RHCSA
---

# ë…¼ë¦¬ ë³¼ë¥¨ ìƒì„± ë° í™•ì¥

## ê°œìš”

<figure class="align-center">
  <img src="/assets/resources/RHCSA/08-LVM_Workflow.jpeg" alt="">
  <figcaption>ì¶œì²˜: https://www.linkedin.com/pulse/integrating-lvm-hadoop-providing-elasticity-datanode-storage-dadi</figcaption>
</figure> 

- ë¬¼ë¦¬ ì¥ì¹˜(ë””ìŠ¤í¬ íŒŒí‹°ì…˜, ì „ì²´ ë””ìŠ¤í¬, RAID array, SAN disk)
- ë¬¼ë¦¬ ë³¼ë¥¨(Physical Volume)
- ë³¼ë¥¨ ê·¸ë£¹(Volume Group)
- ë…¼ë¦¬ ë³¼ë¥¨(Logical Volume)

## LVM ìŠ¤í† ë¦¬ì§€ êµ¬ì¶•

### ë¬¼ë¦¬ ì¥ì¹˜ ì¤€ë¹„

```bash
# íŒŒí‹°ì…”ë‹(íŒŒí‹°ì…˜ì´ ì´ë¯¸ ìˆë‹¤ë©´ ì„ íƒ ì‚¬í•­)
parted /dev/vdb mklabel gpt mkpart primary 1MiB 769MiB
parted /dev/vdb mkpart primary 770MiB 1026MiB
# ê° íŒŒí‹°ì…˜ì„ LVM ìœ í˜•ìœ¼ë¡œ ì„¤ì •
parted /dev/vdb set 1 lvm on
parted /dev/vdb set 2 lvm on
# ìƒˆ íŒŒí‹°ì…˜ì„ ì»¤ë„ì— ì ìš©
udevadm settle
```

### ë¬¼ë¦¬ ë³¼ë¥¨ ìƒì„±

**`pvcreate` ëª…ë ¹** ì´ìš©

```bash
# LVM ìœ í˜•ì˜ ì¥ì¹˜ì— PV ë ˆì´ë¸” ì§€ì •
pvcreate /dev/vdb1 /dev/vdb2
```

### ë³¼ë¥¨ ê·¸ë£¹ ìƒì„±

**`vgcreate` ëª…ë ¹** ì´ìš©

```bash
# PV /dev/vdb1ê³¼ /dev/vdb2ë¥¼ ì´ìš©í•´ ë³¼ë¥¨ ê·¸ë£¹ vg01ì„ ìƒì„±
vgcreate vg01 /dev/vdb1 /dev/vdb2
```

### ë…¼ë¦¬ ë³¼ë¥¨ ìƒì„±

**`lvcreate` ëª…ë ¹** ì´ìš©

- `-L` ì˜µì…˜: ì´ì§„ ë°”ì´íŠ¸ë¡œ ëœ í¬ê¸°(MiB, GiB, â€¦)ë¥¼ ì‚¬ìš©í•´ ë…¼ë¦¬ ë³¼ë¥¨ì˜ í¬ê¸°ë¥¼ ì§€ì •
- `-l` ì˜µì…˜: PE(ë¬¼ë¦¬ í™•ì¥ ì˜ì—­; ê¸°ë³¸ í¬ê¸°ëŠ” ê°œë‹¹ 4MiB)ì˜ ê°œìˆ˜ë¥¼ ì‚¬ìš©í•´ í¬ê¸°ë¥¼ ì§€ì •

```bash
# ë³¼ë¥¨ ê·¸ë£¹ vg01ì— 300MiBì˜ ë…¼ë¦¬ ë³¼ë¥¨ lv01 ìƒì„±
lvcreate -n lv01 -L 300M vg01

# ì´ í¬ê¸°ê°€ 128MiBì¸ ë…¼ë¦¬ ë³¼ë¥¨ì„ ë§Œë“œëŠ” ë‘ ê°€ì§€ ë°©ë²•
lvcreate -n lv01 -L 128M vg01
lvcreate -n lv01 -l 32 vg01
```

### ë…¼ë¦¬ ë³¼ë¥¨ì— íŒŒì¼ ì‹œìŠ¤í…œ ìƒì„±

**`mkfs` ëª…ë ¹** ì´ìš©

```bash
# ìƒˆ ë…¼ë¦¬ ë³¼ë¥¨ì— xfs íŒŒì¼ ì‹œìŠ¤í…œ ìƒì„±
mkfs -t xfs /dev/vg01/lg01

# ë§ˆìš´íŠ¸ ì§€ì  ìƒì„±
mkdir /mnt/data

# ì˜êµ¬ì  ì‚¬ìš©ì„ ìœ„í•´ /etc/fstabì— ë“±ë¡
/dev/vg01/lg01 /mnt/data xfs defaults 0 0

# ë…¼ë¦¬ ë³¼ë¥¨ ë§ˆìš´íŠ¸
mount /dev/vg01/lg01 /mnt/data
```

### VDO(Virtual Data Optimizer; ê°€ìƒ ë°ì´í„° ìµœì í™” ë„êµ¬)ë¥¼ ì´ìš©í•œ ì¤‘ë³µ ì œê±° ë° ì••ì¶•ì„ ì‚¬ìš©í•œ ë…¼ë¦¬ ë³¼ë¥¨ ìƒì„±

>ğŸ¤” ê°œì¸ì ìœ¼ë¡œ VDOê¹Œì§€ ê³ ë ¤í•˜ê¸°ì—” ë„ˆë¬´ Deepí•´ ë³´ì¸ë‹¤.

```bash
# ë¨¼ì € vdo ë° kmod-kvdo ì„¤ì¹˜
dnf install vdo kmod-kvdo

# lvcreate ëª…ë ¹ì— --type vdoë¥¼ ì‚¬ìš©í•´ VDO LV ìƒì„±
lvcreate --type vdo --name vdo-lv01 --size 5G vg01
```

## LVM êµ¬ì„± ì •ë³´ í‘œì‹œ

### ë¬¼ë¦¬ ë³¼ë¥¨ ì •ë³´ í‘œì‹œ

**`pvdisplay` ëª…ë ¹** ì´ìš©

```bash
# PV /dev/vdb1ì˜ ì •ë³´ í‘œì‹œ
pvdisplay /dev/vdb1
```

### ë³¼ë¥¨ ê·¸ë£¹ ì •ë³´ í‘œì‹œ

**`vgdisplay` ëª…ë ¹** ì´ìš©

```bash
# VG vg01ì˜ ì •ë³´ í‘œì‹œ
vgdisplay vg01
```

### ë…¼ë¦¬ ë³¼ë¥¨ ì •ë³´

**`lvdisplay` ëª…ë ¹** ì´ìš©

```bash
# LV /dev/vg01/lv01ì˜ ì •ë³´ í‘œì‹œ
lvdisplay /dev/vg01/lv01
```

# LVM ìŠ¤í† ë¦¬ì§€ í™•ì¥ ë° ì¶•ì†Œ

## ë³¼ë¥¨ ê·¸ë£¹ í¬ê¸° í™•ì¥

**`vgextend` ëª…ë ¹** ì´ìš©

```bash
# í™•ì¥ì— ì‚¬ìš©í•  ë¬¼ë¦¬ ì¥ì¹˜ìš© íŒŒí‹°ì…˜ ìƒì„±
parted /dev/vdb mkpart primary 1072MiB 1648MiB
parted /dev/vdb set 3 lvm on
# íŒŒí‹°ì…˜ ë³€ê²½ ì‚¬í•­ ì ìš©
udevadm settle
# ë¬¼ë¦¬ ì¥ì¹˜ë¡œë¶€í„° ë¬¼ë¦¬ ë³¼ë¥¨ ìƒì„±
pvcreate /dev/vdb3

# ë³¼ë¥¨ ê·¸ë£¹ vg01ì„ ë¬¼ë¦¬ ë³¼ë¥¨ /dev/vdb3ì˜ í¬ê¸°ë§Œí¼ í™•ì¥
vgextend vg01 /dev/vdb3
```

## ë…¼ë¦¬ ë³¼ë¥¨ í¬ê¸° í™•ì¥

**`lvextend` ëª…ë ¹** ì´ìš©

```bash
# ë…¼ë¦¬ ë³¼ë¥¨ì„ í™•ì¥í•  ì—¬ìœ  ê³µê°„ì´ ìˆëŠ”ì§€ ë³¼ë¥¨ ê·¸ë£¹ í™•ì¸
vgdisplay vg01

# ë…¼ë¦¬ ë³¼ë¥¨ /dev/vg01/lv01ì„ 500MiBë§Œí¼ í™•ì¥
lvextend -L +500M /dev/vg01/lv01
```

## íŒŒì¼ ì‹œìŠ¤í…œì„ ë…¼ë¦¬ ë³¼ë¥¨ í¬ê¸°ë¡œ ì¦ì¶•

```bash
# XFS íŒŒì¼ ì‹œìŠ¤í…œ
xfs_growfs /mnt/data/

# EXT4 íŒŒì¼ ì‹œìŠ¤í…œ
resize2fs /dev/vg01/lv01
```

**ë‘˜ ê°„ì˜ ì°¨ì´ì **: `xfs_growfs` ëª…ë ¹ì€ ë§ˆìš´íŠ¸ëœ ëŒ€ìƒì„ ì¸ìˆ˜ë¡œ ë°›ê³ , `resize2fs` ëª…ë ¹ì€ ë…¼ë¦¬ ë³¼ë¥¨ì„ ì¸ìˆ˜ë¡œ ë°›ëŠ”ë‹¤.

## ìŠ¤ì™‘ ê³µê°„ ë…¼ë¦¬ ë³¼ë¥¨ í™•ì¥

```bash
# ìŠ¤ì™‘ ê³µê°„ ë¹„í™œì„±í™”
swapoff -v /dev/vg01/swap

# ë…¼ë¦¬ ë³¼ë¥¨ í™•ì¥
lvextend -L +300M /dev/vg01/swap

# ë…¼ë¦¬ ë³¼ë¥¨ì„ ìŠ¤ì™‘ìœ¼ë¡œ ì „í™˜
mkswap /dev/vg01/swap

# ë…¼ë¦¬ ë³¼ë¥¨ì—ì„œ ìƒˆ ìŠ¤ì™‘ ê³µê°„ í™œì„±í™”
swapon /dev/vg01/swap
```

## ë³¼ë¥¨ ê·¸ë£¹ ìŠ¤í† ë¦¬ì§€ ì¤„ì´ê¸°

```bash
# ë³¼ë¥¨ ê·¸ë£¹ì— ì‚¬ìš©ë˜ì§€ ì•Šì€ ë¬¼ë¦¬ ë³¼ë¥¨ì„ ì œê±°í•´ ë³¼ë¥¨ ê·¸ë£¹ì„ ì¤„ì„
pvmove /dev/vdb3

# ë³¼ë¥¨ ê·¸ë£¹ì—ì„œ ë¬¼ë¦¬ ë³¼ë¥¨ ì œê±°
vgreduce vg01 /dev/vbd3
```

## LVM ìŠ¤í† ë¦¬ì§€ ì œê±°

```bash
# ë¨¼ì € ìœ ì§€í•  ë°ì´í„°ëŠ” ë‹¤ë¥¸ íŒŒì¼ ì‹œìŠ¤í…œìœ¼ë¡œ ì´ë™í•˜ê³ 

# LVM ìŠ¤í† ë¦¬ì§€ê°€ ë§ˆìš´íŠ¸ëœ íŒŒì¼ ì‹œìŠ¤í…œì„ ë§ˆìš´íŠ¸ í•´ì œ
# ê·¸ë¦¬ê³  /etc/fstabì˜ í•­ëª© ë˜í•œ ì œê±°
umount /mnt/data

# ëŒ€ìƒ ë…¼ë¦¬ ë³¼ë¥¨ ì œê±°
lvremove /dev/vg01/lv01

# ëŒ€ìƒ ë³¼ë¥¨ ê·¸ë£¹ ì œê±°
vgremove vg01

# ë¬¼ë¦¬ ë³¼ë¥¨ ì œê±°
pvremove /dev/vdb1 /dev/vdb2
```

# ê³„ì¸µí™”ëœ ìŠ¤í† ë¦¬ì§€ ê´€ë¦¬

## ìŠ¤í† ë¦¬ì§€ ìŠ¤íƒ

ì•„ë˜ì˜ êµ¬ì„± ìˆœì„œë¡œ ìŠ¤íƒì´ êµ¬ì„±ë˜ì–´ ìˆë‹¤. ë°‘ì¤„ì´ ì ìš©ëœ ë¶€ë¶„ì€ ì„ íƒ ì‚¬í•­ì´ë‹¤.

- ë¸”ë¡ ì¥ì¹˜
- ë‹¤ì¤‘ ê²½ë¡œ(multipath)
- íŒŒí‹°ì…˜
- RAID
- LVM
- íŒŒì¼ ì‹œìŠ¤í…œ or ê¸°íƒ€

## Stratis ìŠ¤í† ë¦¬ì§€ ê´€ë¦¬

**Stratis**ëŠ” ë¬¼ë¦¬ì  ìŠ¤í† ë¦¬ì§€ ì¥ì¹˜ í’€ì„ ê´€ë¦¬ ë° íŒŒì¼ ì‹œìŠ¤í…œì˜ ë³¼ë¥¨ì„ ê´€ë¦¬í•˜ëŠ” ì„œë¹„ìŠ¤

### Stratis ì´ìš©í•˜ê¸°

`stratis-cli` ì™€ `stratisd` íŒ¨í‚¤ì§€ë¥¼ ì„¤ì¹˜

>ğŸ’¡ **ì–´ë–¤ íŒ¨í‚¤ì§€ë¥¼ ì„¤ì¹˜í•´ì•¼ í•˜ëŠ”ì§€** ì˜ ê¸°ì–µí•˜ê¸°

```bash
dnf install -y stratis-cli stratisd
systemctl enable --now stratisd
```

**Stratis** í’€ ìƒì„± ë° ê´€ë¦¬

```bash
# í’€ ìƒì„±
stratis pool create pool1 /dev/vdb
# í’€ ëª©ë¡ ì¡°íšŒ
stratis pool list
# í’€ì— ë¸”ë¡ ì¥ì¹˜ ì¶”ê°€
stratis pool add-data pool1 /dev/vdc
# í’€ì˜ ë¸”ë¡ ì¥ì¹˜ ì¡°íšŒ
stratis blockdev list pool1
# í’€ì—ì„œ íŒŒì¼ ì‹œìŠ¤í…œ ìƒì„±
stratis filesystem create pool1 fs1
# ì‚¬ìš© ê°€ëŠ¥í•œ Stratis íŒŒì¼ ì‹œìŠ¤í…œ ëª©ë¡ ì¡°íšŒ
stratis filesystem list
# Stratis íŒŒì¼ ì‹œìŠ¤í…œ ìŠ¤ëƒ…ìƒ· ìƒì„± - ì‹œí—˜ì—” ì•ˆë‚˜ì˜¬ ë“¯
stratis filesystem snapshot pool1 fs1 snapshot1
```

### Stratis íŒŒì¼ ì‹œìŠ¤í…œ ì˜êµ¬ ë§ˆìš´íŠ¸

ì´ì „ ë°©ë²•ê³¼ ê°™ì´ `/etc/fstab` íŒŒì¼ì„ í¸ì§‘í•¨ìœ¼ë¡œì¨ ì˜êµ¬ ë§ˆìš´íŠ¸í•  ìˆ˜ ìˆë‹¤.

```bash
# stratis íŒŒì¼ ì‹œìŠ¤í…œ UUIDë¥¼ /etc/fstabì— ì¶”ê°€
lsblk --output=UUID /dev/stratis/pool1/fs1 >> /etc/fstab
# ì•„ë˜ ëª…ë ¹ìœ¼ë¡œë„ ê°€ëŠ¥
stratis filesystem list

## /etc/fstab
UUID=c7b57190-8fba-463e-8ec8-29c80703d45e /dir1
xfs defaults,xsystemd.requires=stratisd.service 0 0
```

>âš ï¸ `x-systemd.requires=stratisd.service` ë§ˆìš´íŠ¸ ì˜µì…˜ì„ ì¶”ê°€í•´ì¤Œìœ¼ë¡œì¨ ë¶€íŒ… í”„ë¡œì„¸ìŠ¤ ê³¼ì •ì—ì„œ `systemd` ê°€ `stratisd` ì„œë¹„ìŠ¤ë¥¼ ì‹œì‘í•œ ë’¤ ë§ˆìš´íŠ¸ë¥¼ ì§„í–‰í•´ì¤€ë‹¤. í•´ë‹¹ ì˜µì…˜ì„ ì‚¬ìš©í•˜ì§€ ì•Šìœ¼ë©´ `emergency.target` ì—ëŸ¬ê°€ ë°œìƒí•œë‹¤.